#### AOP

- 모듈화된 부가기능(어드바이스)과 적용 대상(포인트컷) 조합을 통해 공통 기능을 손쉽게 개발하고 관리할 수 있는 기능.

1. AOP 인터페이스 구현과 bean 등록
- 스프링 인터페이스를 구현해서 어드바이스와 포인트컷 개발 후 어드바이스, 포인트컷, 어드바이저를 빈으로 등록한다.
- 어드바이저를 프록시로 만들어 적용해주는 자동 프록시 생성기 빈을 등록한다.

2. AOP 인터페이스 구현과 aop:advisor 태그를 이용
- 포인트컷과어드바이저, 자동프록시 생성기 빈 등록을 간결하게 전용태그로 할 수 있다.
```xml
    <aop:config>
        <aop:advisor advice-ref="advice" pointcut="bean(*Service)"/>
    </aop:config>
    <bean id="advice" class="...">...</bean>
```

3. 임의의 자바 클래스와 aop:aspect 태그를 이용
- 애스팩트 사용(임의의 자바 클래스) : 독립적인 aop 모듈
- 인터페이스 구현 없이 애노테이션이나 xml 설정으로 애스펙트로 정의할 수 있다.

4. @AspectJ 애노테이션을 이용해서 애스펙트 개발

#### 프록시 기반 AOP

- 자동 프록시 생성기를 이용해서 만든 빈을 바꿔치기해 프록시 빈을 자동으로 등록해준다.
- 포인트 컷을 이용해 빈을 선택하고 의존관계를 바꿔치기하는 것은 빈 후처리기로 한다.

자동 프록시 생성기 특징
- @Autowired 의존관계 설정에 문제가 없다.
- AOP를 적용하면 다른 빈은 Target 오브젝트에 직접 의존하면 안된다.

#### @AspectJ AOP

- 애스펙트 = 포인트컷 + 어드바이스
- aop:aspectj-autoproxy 태그 : @Aspect가 붙은 클래스를 애스펙트로 등록해준다.
- @Aspect를 붙인 클래스를 만들고 빈으로 등록해야 클래스를 애스펙트로 사용할 수 있다.
- 포인트컷 : 적용할 조인 포인트(메소드)를 선별한다. @Pointcut 애노테이션이 달린 메소드를 이용해 선언한다.
- 어드바이스 : @Before, @After, @Around 등의 애노테이션이 붙은 메소드를 이용해서 정의한다.

#### Pointcut 애노테이션

- within(패키지) : 타입 패턴만 이용해 조인 포인트 메소드를 선택한다.
- this/target : 하나의 타입, 오브젝트를 지정한다. this는 빈 오브젝트의 타입을 확인하고, target은 타깃 오브젝트의 타입과 비교한다.
- args : 메소드의 파라미터 타입만으로 포인트컷을 설정한다.
- @target : 타깃 오브젝트에 특정 애노테이션이 부여된 것 선정
- @within : 타깃 오브젝트의 클래스에 특정 애노테이션이 부여된 것을 찾는다.
- @args : 파라미터 오브젝트에 지정된 애노테이션이 부여되어 있는 경우 선정된다.
- bean : 빈 이름 또는 아이디로 선정

#### Advice

- @Around : 타깃 오브젝트의 메소드가 호출되는 전 과정을 모두 담당할 수 있다.
- @Before : 타깃 오브젝트의 메소드가 실행되기 전에 사용되는 어드바이스.
- @AfterReturning : 타깃 오브젝트의 메소드가 정상적으로 실행을 마친 뒤에 실행되는 어드바이스. returning 엘리먼트를 이용해서 리턴 값을 참조할 수 있다.
- @AfterThrowing : 타깃 오브젝트의 메소드를 호출했을 떄 예외가 발생하면 실행되는 어드바이스. throwing 엘리먼트를 이용해 예외를 전달받을 메소드 파라미터를 설정할 수 있다.
- @After : 메소드 실행이 정상 종료 또는 예외가 발생해도 실행되는 어드바이스. 리소스 반환 등에 사용

#### AspectJ

- AspectJ AOP로 빈이 아닌 도메인 오브젝트에 DI를 적용할 수 있다.
- 오브젝트에 @Configurable 어노테이션을 추가하고, 주입될 객체들을 bean으로 등록하거나 자동와이어링을 사용하면 필요한 객체가 주입된다.
- AspectJ가 동작할 수 있도록 로드타임 위버를 적용한 뒤 XML에 context:load-time-weaver 태그를 추가해줘야한다.
- context:spring-configured 태그를 추가하면 DI 애스펙트가 등록된다.
